<% provide(:title, 'Wall') %>

<% unless @next_comp.nil? %>
  <div class="hero-unit" id="wall">
    <div class="row">
      <div class="span11">
        <div class="row">
          <div class="span2">
            <%= image_tag @next_comp.course.crest, :class => 'pull-left img-polaroid' %>
          </div>
          <div class="span9">
            <h1><%= @next_comp.course.name %></h1>
            <h3><%= @next_comp.competition_date %></h3>
            <p>We are playing the July competition in Luttrellstown Castle on Saturday 23rd July.  Our tee times are booked
            between 2 and 3 pm, so we're going out in fourballs, but places are limited. Please make sure to sign up by clicking the sign up button below.</p>
            <p>Look forward to seeing you all there!</p>
            <%=  link_to "Sign Up!", wall_path, :class => "pull-right btn-large btn-primary" %>
          </div>
        </div>
      </div>
    </div>
  </div>
<% end %>


<!-- Posts and comments -->
<div class="row">
  <div class="span9">
    <% @posts.each do |post| %>
      <div class="row">
        <div class="span2 post-img">
          <%= link_to (image_tag post.user.avatar.url(:thumb), :class => "img-polaroid"), user_path(post.user) %>
          <h4><%= h(post.user.firstname) %> <%= h(post.user.surname) %></h4>
          <p><%= time_ago_in_words(post.created_at) %> ago</p>
        </div>

        <div class="span7">
          <!-- the post and post title -->
          <p>
            <span class="post-title">
              <%= h(post.title) %>
            </span>
            <% if is_admin or post.user == current_user %>
                <%= link_to '<i class="icon-remove"></i>'.html_safe, post, method: :delete, data: { confirm: 'Are you sure, all comments will also be deleted?' }, :class => "pull-right", :title => "Delete Post" %>
                <%= link_to '<i class="icon-pencil"></i>'.html_safe, edit_post_path(post), :class => "pull-right", :title => "Edit Post" %>
          <% end %>
          </p>

          <!-- display an image if it exists -->
          <% if post.photo.exists? %>
              <%= image_tag post.photo.url(:wall), :class => 'img img-polaroid' %>
          <% end %>


          <!-- the message -->
          <p><%= post.message %></p>


          <!-- Associated comments -->
          <% post.comments.each do |comment| %>
            <div class="row">
              <hr>
              <div class="span1">
                <%= link_to (image_tag comment.user.avatar.url(:micro), :class => "img-polaroid pull-left"), user_path(comment.user) %>
              </div>
              <div class="span6">
                <span class="user"><%= comment.user.firstname %> <%= comment.user.surname %></span>
                <% if is_admin or comment.user == current_user %>
                    <!-- the admin or comment author can delete a comment -->
                    <%= link_to '<i class="icon-remove"></i>'.html_safe, comment, method: :delete, data: { confirm: 'Are you sure you want to delete this comment?' }, :class => "pull-right", :title => "Delete Comment" %>
                    <%= link_to '<i class="icon-pencil"></i> '.html_safe, edit_comment_path(comment), :class => "pull-right", :title => "Edit Comment" %>
                <% end %>
                <p>
                  <%= comment.comment %>
                  <span class="comment-date"><%= time_ago_in_words(comment.created_at) %> ago</span>
                </p>
              </div>
            </div>
          <% end %>


          <!-- Add a new comment -->
          <div class="row">
            <hr>
            <div class="span1">
              <%=  image_tag current_user.avatar(:micro), :class => "img-polaroid" %>
             </div>
            <div class="span6">
              <%= form_for @comment do |f| %>
                <%=  f.hidden_field :post_id, :value => post.id %>
                <%=  f.hidden_field :user_id, :value => current_user.id %>
                <%=  f.text_area :comment, :placeholder => "Write a comment...", :class => "text_area" %>
                <%=  f.submit "Add Comment", :class=>'btn btn-primary pull-right' %>
              <% end %>
            </div>
          </div>

        </div>
      </div>
       <hr>
    <% end %>
  </div>

  <div class="span3">

    <div class="row">

      <div class="widget span3">
        <ul class="nav nav-list">
          <li class="nav-header">Actions</li>
          <li>
            <a href="#myModal" data-toggle="modal">
              Post to your wall
            </a>
          </li>


          <li><%= link_to "Post a picture on your wall", new_post_path %></li>
          <li><%= link_to "Add a video to your wall", new_post_path %></li>
          <li><%= link_to "Record New Round", new_round_path %></li>
          <% if is_admin %>
              <li><%= link_to "Users Administration", users_path %></li>
              <li><%= link_to "Create a new competition" %></li>
              <li><%= link_to "Competition Administration" %></li>
              <li><%= link_to "Create a new course", new_course_path %></li>
              <li><%= link_to "Course Administration", new_course_path %></li>
          <% end %>
        </ul>

      </div>
      <% unless @prev_comp.nil? %>
          <div class="widget span3">
            <h3>Last Competition</h3>
            <h4><%= @prev_comp.course.name %></h4>
            <p><%= @prev_comp.competition_date %></p>
            <table class="table table-hover">
              <thead>
              <th>Name</th>
              <th>Points</th>
              <th>Back 9</th>
              </thead>
              <tbody>
              <% @prev_comp.results.each do |round| %>

                <tr>
                  <td><%= round.user.firstname %> <%= round.user.surname %></td>
                  <td><%= round.total_score %></td>
                  <td><%= round.back_nine %></td>
                </tr>

              <% end %>
              </tbody>
            </table>
            <%= link_to "Full Result", rounds_path, :class => "btn btn-mini btn-primary pull-right" %>
        </div>
      <% end %>
    </div>

  </div>


</div>

</div>

<!-- Modal -->
<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <h3 id="myModalLabel">Write a post to your wall</h3>
  </div>
  <div class="modal-body">
    <%= render "posts/form", :@post => Post.new %>
    <button class="btn btn-danger" data-dismiss="modal" aria-hidden="true">Cancel</button>
  </div>
</div>